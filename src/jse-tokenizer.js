!function(e,r){var t="jseTokenizer",n=[];if("function"==typeof define&&define.amd)define(t,n,r);else if("object"==typeof exports){var o=n.map(function(e){return require(e)});module.exports=r.apply(e,o)}else{var o=n.map(function(r){return e[r]});e[t]=r.apply(e,o)}}(this,function(){function e(e,r,t){var n,o=!0,a=e[r],s="";for(r+=1;o&&(n=e[r]);)n===a?(o=!1,t&&(n="")):"\\"===n&&(s+="\\",r+=1),s+=n,r+=1;return t?{cursor:r,string:s}:{cursor:r,string:a+s}}function r(e,r){for(var t;(t=e[r])&&g[t];)r+=1;return r}function t(e,r){var t=u(e,!0,r+1);return{cursor:t.cursor,string:t.text}}function n(e,r,t){var n=o(e,r+1),a={},s={};return n.name&&(a=i(e,n.cursor)),b(s,n,a),{cursor:s.cursor,tag:s.name?s:null}}function o(e,t){var n,o="",a=!0;for(t=r(e,t),"/"===e[t]&&(a=!1,t=r(e,t+1));(n=e[t])&&!g[n]&&">"!==n;){if(d[n]){o="";break}o+=n,t+=1}if(o){var s={name:o,cursor:t,open:a,selfClosing:!1};return s["native"]=void 0!==p[o],s["native"]?s.selfClosing=!!p[o]:s["native"]=-1!==o.indexOf("-"),s}return{cursor:t}}function a(){return v+=1,x.push({text:"",tagContext:0,braceCounter:0,cursor:0})}function s(){return v-=1,x.pop()}function i(n,o){for(var a,s={"'":1,'"':1},i=[],u="",f=!1,c=!0;a=n[o];){if("/"===a){o=r(n,o+1),">"!==n[o]||(f=!0),""!==u&&i.push({name:u,value:"true",type:"expression"});break}if(">"===a)break;if(c)if(!g[a]&&"="!==a||""===u)if("{"===a&&""===u){var l=e(n,o,!0);i.push({value:l.string,type:"extend"}),o=l.cursor-1}else d[a]||g[a]||(u+=a);else c=!1;else{if(o=r(n,o),a=n[o],s[a]){var l=e(n,o,!0);o=l.cursor-1,i.push({name:u,value:l.string,type:"string"}),u=""}else if("{"===a){var l=t(n,o);o=l.cursor,i.push({name:u,value:l.string,type:"expression"}),u=""}else i.push({name:u,value:"true",type:"expression"}),u=a;c=!0}o+=1}var p={attrs:i,cursor:o};return f&&(p.selfClosing=f),p}function u(r,o,i){a(),o&&(x[v].braceCounter+=1),i=i||0;for(var u,c="",l=0;u=r[i];){if(o&&("}"===u?x[v].braceCounter-=1:"{"===u&&(x[v].braceCounter+=1),!x[v].braceCounter))return x[v].cursor=i,""!==c&&f("text",c),s();if(m[u]){var p=e(r,i);c+=p.string,i=p.cursor,u=""}if("$"===u&&"{"===r[i+1]){c&&f("text",c);var p=t(r,i+1);f("expression",p.string),i=p.cursor+1,c="",u=""}else if("<"===u){var p=n(r,i);p.tag?(i=p.cursor+1,c&&(l?(f("text",c,!0),c=""):(f("text",c),c="")),p.tag.open?(x[v].tagContext||(p.tag.root=!0),p.tag.selfClosing||(x[v].tagContext+=1),"text"!==p.tag.name?f("openTag",p.tag):l+=1):(p.tag.selfClosing||(x[v].tagContext-=1),"text"!==p.tag.name?(x[v].tagContext||(p.tag.root=!0),f("closeTag",p.tag)):l-=1),u=""):i+=1}else i+=1;c+=u}return""!==c&&f("text",c),x[v].cursor=i,s()}function f(e,r,t){for(var n=0;n<h[e].length;n++){var o=h[e][n](r,t);o&&(x[v].text+=o)}}function c(e,r){return r instanceof Function?(h[e].push(r),!0):!1}function l(e,r){var t=h[e].indexOf(r);return-1!==t?(h[e].splice(t,0),!0):!1}var p={a:0,abbr:0,acronym:0,address:0,applet:0,area:1,article:0,aside:0,audio:0,b:0,base:1,basefont:0,bdi:0,bdo:0,big:0,blockquote:0,body:0,br:1,button:0,canvas:0,caption:0,command:1,center:0,cite:0,code:0,col:1,colgroup:0,datalist:0,dd:0,del:0,details:0,dfn:0,dialog:0,dir:0,div:0,dl:0,dt:0,em:0,embed:1,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:0,frameset:0,h1:0,head:0,header:0,hr:1,html:0,i:0,iframe:0,img:1,input:1,ins:0,kbd:0,keygen:1,label:0,legend:0,li:0,link:1,main:0,map:0,mark:0,menu:0,menuitem:0,meta:1,meter:0,nav:0,noframes:0,noscript:0,object:0,ol:0,optgroup:0,option:0,output:0,p:0,param:1,pre:0,progress:0,q:0,rp:0,rt:0,ruby:0,s:0,samp:0,script:0,section:0,select:0,small:0,source:1,span:0,strike:0,strong:0,style:0,sub:0,summary:0,sup:0,table:0,tbody:0,td:0,textarea:0,tfoot:0,th:0,thead:0,time:0,title:0,tr:0,track:1,tt:0,u:0,ul:0,"var":0,video:0,wbr:1},g={"\n":1,"\r":1,"	":1,"\b":1," ":1,"\x0B":1,"\f":1},d={"`":1,"~":1,"!":1,"@":1,"#":1,"%":1,"^":1,"&":1,"*":1,"(":1,")":1,"=":1,"+":1,"\\":1,"|":1,"/":1,",":1,"<":1,">":1,"?":1,'"':1,";":1,":":1,"'":1,"{":1,"}":1,"[":1,"]":1},m={'"':1,"'":1,"`":1},b=function(){for(var e=arguments[0],r=0;r<arguments.length;r++)for(var t=0,n=Object.keys(arguments[r]||{});t<n.length;t++)e[n[t]]=arguments[r][n[t]];return e},v=-1,x=[],h={openTag:[],closeTag:[],text:[],error:[],expression:[]},y="";return{onOpenTag:c.bind(this,"openTag"),onCloseTag:c.bind(this,"closeTag"),onText:c.bind(this,"text"),onError:c.bind(this,"error"),onExpression:c.bind(this,"expression"),offOpenTag:l.bind(this,"openTag"),offCloseTag:l.bind(this,"closeTag"),offText:l.bind(this,"text"),offError:l.bind(this,"error"),offExpression:l.bind(this,"expression"),write:function(e){y+=e},end:function(){return u(y).text},parse:function(e){return u(e).text}}});