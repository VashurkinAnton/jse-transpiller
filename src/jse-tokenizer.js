!function(e,r){var t="jseTokenizer",n=[];if("function"==typeof define&&define.amd)define(t,n,r);else if("object"==typeof exports){var o=n.map(function(e){return require(e)});module.exports=r.apply(e,o)}else{var o=n.map(function(r){return e[r]});e[t]=r.apply(e,o)}}(this,function(){function e(e,r,t){var n,o=!0,i=e[r],s="";for(r+=1;o&&(n=e[r]);)n===i?(o=!1,t&&(n="")):"\\"===n&&(s+="\\",r+=1),s+=n,r+=1;return t?{cursor:r,string:s}:{cursor:r,string:i+s}}function r(e,r){for(var t;(t=e[r])&&g[t];)r+=1;return r}function t(e,r){var t,n=1,o="";for(r+=1;(t=e[r])&&("{"===t?n+=1:"}"===t&&(n-=1),n);)o+=t,r+=1;return{cursor:r,string:o}}function n(e,r,t){var n=o(e,r+1),s={},a={};return n.name&&(s=i(e,n.cursor)),m(a,n,s),{cursor:a.cursor,tag:a.name?a:null}}function o(e,t){var n,o="",i=!0;for(t=r(e,t),"/"===e[t]&&(i=!1,t=r(e,t+1));(n=e[t])&&!g[n]&&">"!==n;){if(p[n]){o="";break}o+=n,t+=1}if(o){var s={name:o,cursor:t,open:i,selfClosing:!1};return s["native"]=void 0!==l[o],s["native"]?s.selfClosing=!!l[o]:s["native"]=-1!==o.indexOf("-"),s}return{cursor:t}}function i(n,o){for(var i,s={"'":1,'"':1},a=[],f="",u=!1,c=!0;i=n[o];){if("/"===i){o=r(n,o+1),">"!==n[o]||(u=!0);break}if(">"===i)break;if(c)!g[i]&&"="!==i||""===f?p[i]||g[i]||(f+=i):c=!1;else if(o=r(n,o),i=n[o],s[i]){var l=e(n,o,!0);o=l.cursor-1,a.push({name:f,value:l.string,type:"string"}),f="",c=!0}else if("{"===i){var l=t(n,o);o=l.cursor,a.push({name:f,value:l.string,type:"expression"}),f="",c=!0}o+=1}var d={attrs:a,cursor:o};return u&&(d.selfClosing=u),d}function s(r,t){var n,o="",i=1;for(t+=1;n=r[t];){if(d[n]){var s=e(r,t);o+=s.string,t=s.cursor,n=""}else"{"===n?i+=1:"}"===n&&(i-=1);if(!i){t+=1;break}o+=n,t+=1}return{string:o,cursor:t}}function a(r){for(var t,o=0,i="",a=0;t=r[o];){if(d[t]){var u=e(r,o);i+=u.string,o=u.cursor,t=""}else if("<"===t){var u=n(r,o);if(u.tag){if(o=u.cursor+1,i)if(v){for(var c="",l="",p=0,m=!1;t=i[p];){if(d[t]){var b=e(i,p);c+=b.string,p=b.cursor,t=""}else if("$"===t)m=!0,l+=t,t="";else if(g[t]&&m)l+=t;else if("{"===t&&m){a?f("text",c,!0):f("text",c);var b=s(i,p);p=b.cursor,t="",m=!1,f("expression",b.string),l="",c=""}else m&&(m=!1,c+=l,l="");c+=t,p+=1}c&&(a?f("text",c,!0):f("text",c))}else f("text",i);u.tag.open?(v||(u.tag.root=!0),u.tag.selfClosing||(v+=1),"text"!==u.tag.name?f("openTag",u.tag):a+=1):(u.tag.selfClosing||(v-=1),"text"!==u.tag.name?(v||(u.tag.rootEnd=!0),f("closeTag",u.tag)):a-=1),i="",t=""}else o+=1}else o+=1;i+=t}""!==i&&f("text",i)}function f(e,r,t){for(var n=0;n<b[e].length;n++){var o=b[e][n](r,t);o&&(x+=o)}}function u(e,r){return r instanceof Function?(b[e].push(r),!0):!1}function c(e,r){var t=b[e].indexOf(r);return-1!==t?(b[e].splice(t,0),!0):!1}var l={a:0,abbr:0,acronym:0,address:0,applet:0,area:1,article:0,aside:0,audio:0,b:0,base:1,basefont:0,bdi:0,bdo:0,big:0,blockquote:0,body:0,br:1,button:0,canvas:0,caption:0,command:1,center:0,cite:0,code:0,col:1,colgroup:0,datalist:0,dd:0,del:0,details:0,dfn:0,dialog:0,dir:0,div:0,dl:0,dt:0,em:0,embed:1,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:0,frameset:0,h1:0,head:0,header:0,hr:1,html:0,i:0,iframe:0,img:1,input:1,ins:0,kbd:0,keygen:1,label:0,legend:0,li:0,link:1,main:0,map:0,mark:0,menu:0,menuitem:0,meta:1,meter:0,nav:0,noframes:0,noscript:0,object:0,ol:0,optgroup:0,option:0,output:0,p:0,param:1,pre:0,progress:0,q:0,rp:0,rt:0,ruby:0,s:0,samp:0,script:0,section:0,select:0,small:0,source:1,span:0,strike:0,strong:0,style:0,sub:0,summary:0,sup:0,table:0,tbody:0,td:0,textarea:0,tfoot:0,th:0,thead:0,time:0,title:0,tr:0,track:1,tt:0,u:0,ul:0,"var":0,video:0,wbr:1},g={"\n":1,"\r":1,"	":1,"\b":1," ":1,"\x0B":1,"\f":1},p={"`":1,"~":1,"!":1,"@":1,"#":1,"%":1,"^":1,"&":1,"*":1,"(":1,")":1,"=":1,"+":1,"\\":1,"|":1,"/":1,",":1,"<":1,">":1,"?":1,'"':1,";":1,":":1,"'":1,"{":1,"}":1,"[":1,"]":1},d={'"':1,"'":1,"`":1},m=function(){for(var e=arguments[0],r=0;r<arguments.length;r++)for(var t=0,n=Object.keys(arguments[r]||{});t<n.length;t++)e[n[t]]=arguments[r][n[t]];return e},v=0,b={openTag:[],closeTag:[],text:[],error:[],expression:[]},x="",h="";return{onOpenTag:u.bind(this,"openTag"),onCloseTag:u.bind(this,"closeTag"),onText:u.bind(this,"text"),onError:u.bind(this,"error"),onExpression:u.bind(this,"expression"),offOpenTag:c.bind(this,"openTag"),offCloseTag:c.bind(this,"closeTag"),offText:c.bind(this,"text"),offError:c.bind(this,"error"),offExpression:c.bind(this,"expression"),write:function(e){h+=e},end:function(){a(h);var e=x;return x="",h="",e},parse:function(e){a(e);var r=x;return x="",r}}});